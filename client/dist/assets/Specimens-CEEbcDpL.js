import{u as F,r as a,j as e,a as p}from"./index-pB9rXeLh.js";function D(){const{token:x}=F(),[C,w]=a.useState([]),[o,v]=a.useState(""),[h,j]=a.useState(""),[r,g]=a.useState(["","","",""]),[l,N]=a.useState(0),[d,b]=a.useState("active"),[c,f]=a.useState({}),[S,m]=a.useState(""),[y,O]=a.useState(!1),I=a.useMemo(()=>!!(o.trim()&&r.length===4&&r.every(s=>s.trim().length>0)&&Number.isInteger(Number(l))&&Number(l)>=0&&Number(l)<=3&&(d==="active"||d==="inactive")),[o,r,l,d]),U=async()=>{const s=await p("/api/admin/specimens",{token:x});w(s.specimens||[])};a.useEffect(()=>{U().catch(s=>m((s==null?void 0:s.message)||"Failed to load specimens"))},[x]);const E=async s=>{var i;const t=(i=s.target.files)==null?void 0:i[0];if(!t)return;const n=new FormData;n.append("file",t),m("");try{const u=await p("/api/admin/upload/specimen-image",{token:x,method:"POST",body:n,headers:{}});v(u.url||"")}catch(u){m((u==null?void 0:u.message)||"Upload failed")}},T=()=>{const s={};o.trim()||(s.imageUrl="Image URL is required");const t=r.map(i=>i.trim());(t.length!==4||t.some(i=>!i))&&(s.options="Enter all 4 options");const n=Number(l);return(!Number.isInteger(n)||n<0||n>3)&&(s.correct="Correct option must be 0-3"),d!=="active"&&d!=="inactive"&&(s.status="Status must be active or inactive"),f(s),Object.keys(s).length===0},A=async s=>{if(s.preventDefault(),m(""),!!T()){O(!0);try{await p("/api/admin/specimens",{token:x,method:"POST",body:{imageUrl:o.trim(),questionText:h.trim()||null,options:r.map(t=>t.trim()),correct:Number(l),status:d}}),v(""),j(""),g(["","","",""]),N(0),b("active"),await U()}catch(t){m((t==null?void 0:t.message)||"Failed to save specimen"),t!=null&&t.details&&f(t.details)}finally{O(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Add Specimen"})}),e.jsxs("div",{className:"card-body",children:[S?e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700 mb-4",children:S}):null,e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:E,className:"input"}),c.imageUrl?e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.imageUrl}):null,o?e.jsx("img",{src:o,alt:"preview",className:"mt-2 h-32 w-auto rounded border"}):null]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Question Text (optional)"}),e.jsx("input",{className:"input",value:h,onChange:s=>j(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Options"}),e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:r.map((s,t)=>e.jsx("input",{className:"input",placeholder:`Option ${t+1}`,value:s,onChange:n=>{const i=[...r];i[t]=n.target.value,g(i)}},t))}),c.options?e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.options}):null]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Correct Option"}),e.jsxs("select",{className:"input",value:String(l),onChange:s=>N(Number(s.target.value)),children:[e.jsx("option",{value:"0",children:"Option 1 (A)"}),e.jsx("option",{value:"1",children:"Option 2 (B)"}),e.jsx("option",{value:"2",children:"Option 3 (C)"}),e.jsx("option",{value:"3",children:"Option 4 (D)"})]}),c.correct?e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.correct}):null]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:d,onChange:s=>b(s.target.value),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),c.status?e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.status}):null]})]}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:!I||y,children:y?"Savingâ€¦":"Save Specimen"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-base font-semibold",children:"Specimens"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"space-y-3",children:C.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-slate-200 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.imageUrl,alt:"",className:"h-12 w-12 rounded border object-cover"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:["Specimen #",s.id]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Correct: ",s.correct]})]})]}),e.jsx("span",{className:`badge ${s.status==="active"?"badge-success":""}`,children:s.status})]},s.id))})})]})]})}export{D as default};
