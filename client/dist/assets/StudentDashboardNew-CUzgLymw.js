import{r as x,j as e,a as L,u as P,L as v}from"./index-pB9rXeLh.js";function q(r){const i=String((r==null?void 0:r.title)||"").toLowerCase(),s=String((r==null?void 0:r.message)||"").toLowerCase(),a=`${i} ${s}`;return/(mock|test)/i.test(a)?{kind:"mock_test",icon:"ðŸ””"}:/(video)/i.test(a)?{kind:"video",icon:"ðŸŽ¥"}:/(announce|announcement|notice|update)/i.test(a)?{kind:"announcement",icon:"ðŸ“¢"}:null}function V(r){const i=q(r);if(!i)return null;const s=String((r==null?void 0:r.title)||"").trim(),a=String((r==null?void 0:r.message)||"").trim(),f=s?a?`${s}: ${a}`:s:a;return f?`${i.icon} ${f}`:null}function E(r){const i=(r||[]).filter(Boolean);return i.length?i.join("     â€¢     "):""}function I({token:r,initialNotifications:i=[],autoRefresh:s=!0}){const[a,f]=x.useState(Array.isArray(i)?i:[]),b=x.useRef(""),w=x.useMemo(()=>{const d={mock_test:[],video:[],announcement:[]};for(const n of a||[]){const l=q(n);if(!l)continue;const c=V(n);c&&(d[l.kind]||(d[l.kind]=[]),d[l.kind].push(c))}const p=n=>{const l=[],c=new Set;for(const m of n||[])c.has(m)||(c.add(m),l.push(m));return l};return{row1:p([...d.mock_test||[],...d.announcement||[]]),row2:p([...d.video||[]])}},[a]);x.useEffect(()=>{f(Array.isArray(i)?i:[])},[i]),x.useEffect(()=>{if(!s||!r)return;const d=async()=>{try{const n=await L("/api/student/dashboard",{token:r}),l=Array.isArray(n==null?void 0:n.notifications)?n.notifications:[],c=l.map(m=>`${m.id}:${m.title}`).join("|");c&&c!==b.current&&(b.current=c,f(l))}catch{}};d();const p=setInterval(d,2e4);return()=>clearInterval(p)},[r,s]);const N=E(w.row1)||"ðŸ”” Announcements will appear here",y=E(w.row2)||"ðŸŽ¥ New content updates will appear here";return e.jsx("div",{className:"card overflow-hidden",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"relative overflow-hidden rounded-2xl border border-slate-200/70 bg-white",children:e.jsx("div",{className:"ticker-track whitespace-nowrap px-4 py-2 text-sm font-medium text-slate-800",children:e.jsxs("div",{className:"inline-flex",children:[e.jsx("span",{className:"pr-10",children:N}),e.jsx("span",{className:"pr-10","aria-hidden":"true",children:N})]})})}),e.jsx("div",{className:"relative overflow-hidden rounded-2xl border border-slate-200/70 bg-white",children:e.jsx("div",{className:"ticker-track-slow whitespace-nowrap px-4 py-2 text-sm font-medium text-slate-800",children:e.jsxs("div",{className:"inline-flex",children:[e.jsx("span",{className:"pr-10",children:y}),e.jsx("span",{className:"pr-10","aria-hidden":"true",children:y})]})})})]})})})}function _(){var p,n,l,c,m,S,$,A,U;const{token:r,user:i}=P(),[s,a]=x.useState(null),[f,b]=x.useState(""),[w,N]=x.useState(!0),y="http://localhost:5001",d=t=>{const u=String(t||"").trim();return u?/^https?:\/\//i.test(u)?u:`${y}${u.startsWith("/")?"":"/"}${u}`:""};return x.useEffect(()=>{let t=!0;return(async()=>{try{b(""),N(!0);const j=await L("/api/student/dashboard",{token:r});if(!t)return;a(j)}catch(j){if(!t)return;b((j==null?void 0:j.message)||"Failed to load dashboard")}finally{t&&N(!1)}})(),()=>{t=!1}},[r]),w?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card animate-pulse",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-6 w-32 bg-slate-200 rounded"})})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3,4,5,6].map(t=>e.jsx("div",{className:"card animate-pulse",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded"}),e.jsx("div",{className:"mt-2 h-3 w-32 bg-slate-200 rounded"})]})},t))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card overflow-hidden",children:e.jsx("div",{className:"card-body bg-gradient-to-r from-primary-50 via-white to-slate-50",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-xl font-semibold",children:"Student Dashboard"}),e.jsxs("p",{className:"mt-1 text-sm text-slate-600",children:["Welcome back, ",i==null?void 0:i.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"badge",children:"KCET Prep"}),e.jsx("span",{className:"badge-success",children:"Active"})]})]})})}),e.jsx(I,{token:r,initialNotifications:(s==null?void 0:s.notifications)||[],autoRefresh:!0}),Array.isArray(s==null?void 0:s.premiumPlans)&&s.premiumPlans.length?e.jsx("div",{className:"card overflow-hidden",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Premium Access"}),e.jsx("div",{className:"mt-1 text-xs text-slate-600",children:(p=s==null?void 0:s.premiumStatus)!=null&&p.comboActive||(n=s==null?void 0:s.premiumStatus)!=null&&n.pyqActive||(l=s==null?void 0:s.premiumStatus)!=null&&l.materialActive?"Your premium is active.":"Unlock PYQs and Premium Materials."})]}),e.jsx(v,{to:"/student/premium",className:"btn-primary text-xs",children:"View Plans"})]}),e.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:s.premiumPlans.map(t=>e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-900",children:t.name}),e.jsx("div",{className:"mt-1 text-sm font-bold",children:t.isFree?"Free":(Number(t.pricePaise||0)/100).toLocaleString("en-IN",{style:"currency",currency:"INR"})})]},t.code))})]})}):null,null,f?e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:f})})}):null,(c=s==null?void 0:s.settings)!=null&&c.testsEnabled&&((m=s==null?void 0:s.tests)!=null&&m.length)?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Mock Tests"}),e.jsx(v,{to:"/student/tests",className:"btn-ghost",children:"View all"})]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:s.tests.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsx("h3",{className:"font-medium mb-2",children:t.title}),e.jsxs("div",{className:"text-sm text-slate-600 mb-3",children:[t.questionCount," questions â€¢ ",t.perQuestionSeconds,"s per question"]}),e.jsx(v,{to:`/student/mock-test/${t.id}`,className:"btn-primary w-full text-center",children:"Start Test"})]},t.id))})})]}):null,(S=s==null?void 0:s.settings)!=null&&S.videosEnabled&&(($=s==null?void 0:s.videos)!=null&&$.length)?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Educational Videos"}),e.jsx(v,{to:"/student/videos",className:"btn-ghost",children:"View all"})]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:s.videos.slice(0,6).map(t=>{const u=o=>{const h=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/watch\?.*v=([^&\n?#]+)/];for(const k of h){const g=o.match(k);if(g)return g[1]}return null},T=(o=>{const h=u(o);return h?`https://i.ytimg.com/vi/${h}/hqdefault.jpg`:null})(t.videoUrl);return e.jsxs("div",{className:"border rounded-lg overflow-hidden hover:shadow-md transition-shadow",children:[T?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:T,alt:t.title,className:"w-full h-48 object-cover",onError:o=>{const h=u(t.videoUrl);if(h){const g=o.target.src.split("/").pop();g==="hqdefault.jpg"?o.target.src=`https://i.ytimg.com/vi/${h}/sddefault.jpg`:g==="sddefault.jpg"?o.target.src=`https://i.ytimg.com/vi/${h}/mqdefault.jpg`:g==="mqdefault.jpg"?o.target.src=`https://i.ytimg.com/vi/${h}/default.jpg`:o.target.src="https://via.placeholder.com/400x225?text=Video+Thumbnail"}else o.target.src="https://via.placeholder.com/400x225?text=Video+Thumbnail"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-colors flex items-center justify-center",children:e.jsx("a",{href:t.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full p-3 transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})})]}):e.jsx("div",{className:"w-full h-48 bg-slate-200 flex items-center justify-center",children:e.jsx("a",{href:t.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"bg-white rounded-full p-3 shadow-md hover:shadow-lg transition-shadow",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-base mb-1 line-clamp-2",children:t.title}),e.jsx("div",{className:"text-sm text-slate-600 mb-2",children:t.subject}),e.jsxs("a",{href:t.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),"Watch Video"]})]})]},t.id)})})})]}):null,(A=s==null?void 0:s.settings)!=null&&A.pdfsEnabled&&((U=s==null?void 0:s.pdfs)!=null&&U.length)?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Latest Documents"}),e.jsx(v,{to:"/student/materials/free",className:"btn-ghost",children:"View all"})]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:s.pdfs.slice(0,6).map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-slate-200 bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:t.title}),e.jsx("div",{className:"text-xs text-slate-500",children:t.subject})]}),t.locked?e.jsx(v,{to:"/student/premium",className:"btn-primary text-xs",children:"Unlock"}):e.jsx("a",{href:d(t.pdfUrl),target:"_blank",rel:"noopener noreferrer",className:"btn-primary text-xs",children:"View"})]},t.id))})})]}):null,null]})}export{_ as default};
