import{u as D,c as $,r as t,a as b,j as e}from"./index-pB9rXeLh.js";function O(){const{token:r}=D(),v=$(),[k,U]=t.useState([]),[y,h]=t.useState([]),[f,o]=t.useState([]),[i,R]=t.useState(""),[n,x]=t.useState(""),[u,d]=t.useState(null),[a,m]=t.useState(""),[q,g]=t.useState(!0),[N,p]=t.useState(!1),[w,L]=t.useState(!1),[j,S]=t.useState(!1),[P,c]=t.useState(""),C="http://localhost:5001";t.useEffect(()=>()=>{a&&URL.revokeObjectURL(a)},[a]),t.useEffect(()=>{(async()=>{try{c(""),g(!0);const s=await b("/api/student/exam-centres",{token:r});U(Array.isArray(s==null?void 0:s.centres)?s.centres:[])}catch(s){c((s==null?void 0:s.message)||"Failed to load exam centres")}finally{g(!1)}})()},[r]),t.useEffect(()=>{if(!i){h([]),x(""),o([]),d(null);return}(async()=>{try{c(""),p(!0),h([]),x(""),o([]),d(null),a&&(URL.revokeObjectURL(a),m(""));const s=await b(`/api/student/exam-centres/${i}/years`,{token:r});h(Array.isArray(s==null?void 0:s.years)?s.years:[])}catch(s){c((s==null?void 0:s.message)||"Failed to load years")}finally{p(!1)}})()},[i,r]),t.useEffect(()=>{if(!i||!n){o([]),d(null);return}(async()=>{try{c(""),L(!0),o([]),d(null),a&&(URL.revokeObjectURL(a),m(""));const s=new URLSearchParams({centreId:i,year:n}),l=await b(`/api/student/pyqs/by-centre-year?${s.toString()}`,{token:r});o(Array.isArray(l==null?void 0:l.pyqs)?l.pyqs:[])}catch(s){c((s==null?void 0:s.message)||"Failed to load PYQs")}finally{L(!1)}})()},[i,n,r]);const Y=async s=>{try{if(s!=null&&s.locked){c("Premium access required"),v("/student/premium");return}c(""),S(!0),d(s),a&&(URL.revokeObjectURL(a),m(""));const l=await fetch(`${C}/api/student/pyqs/${s.id}/pdf`,{headers:{...r?{Authorization:`Bearer ${r}`}:{}}});if(!l.ok){const E=await l.text();throw new Error(E||`Failed to load PDF (${l.status})`)}const F=await l.blob(),A=URL.createObjectURL(F);m(A)}catch(l){c((l==null?void 0:l.message)||"Failed to load PDF"),d(null)}finally{S(!1)}};return q?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card animate-pulse",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-6 w-48 bg-slate-200 rounded"})})}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(s=>e.jsx("div",{className:"card animate-pulse",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-4 w-32 bg-slate-200 rounded"}),e.jsx("div",{className:"mt-2 h-3 w-24 bg-slate-200 rounded"})]})},s))})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Previous Year Questions"})}),e.jsxs("div",{className:"card-body",children:[P?e.jsx("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:P}):null,e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Exam Centre"}),e.jsxs("select",{className:"input",value:i,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"",children:"Select centre"}),k.map(s=>e.jsx("option",{value:String(s.id),children:s.name},s.id))]}),N?e.jsx("div",{className:"mt-2 text-xs text-slate-600",children:"Loading years..."}):null]}),u&&a?e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:u.title}),e.jsxs("div",{className:"text-xs text-slate-600",children:[u.subject," • ",u.year]})]}),e.jsx("button",{type:"button",className:"btn-ghost",onClick:()=>{d(null),a&&(URL.revokeObjectURL(a),m(""))},children:"Back"})]}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-slate-200",onContextMenu:s=>s.preventDefault(),onKeyDown:s=>{(s.ctrlKey||s.metaKey)&&["p","s"].includes(String(s.key||"").toLowerCase())&&s.preventDefault()},tabIndex:0,children:j?e.jsx("div",{className:"p-4 text-sm text-slate-600",children:"Loading PDF..."}):e.jsx("iframe",{title:"PYQ PDF Viewer",src:`${a}#toolbar=0&navpanes=0&scrollbar=0`,className:"h-[80vh] w-full bg-white"})})]}):e.jsx("div",{className:"mt-6",children:i?n?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Year ",n]}),w?e.jsx("div",{className:"mt-1 text-xs text-slate-600",children:"Loading papers..."}):null]}),e.jsx("button",{type:"button",className:"btn-ghost",onClick:()=>x(""),children:"Back to years"})]}),f.length===0&&!w?e.jsxs("div",{className:"text-sm text-slate-600",children:["No PYQs found for ",n,"."]}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-slate-200 bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:s.title}),e.jsxs("div",{className:"text-xs text-slate-500",children:[s.subject," • ",s.year]}),e.jsx("div",{className:"mt-2",children:String(s.accessType||"").toLowerCase()==="paid"?s.locked?e.jsx("span",{className:"badge",children:"Locked"}):e.jsx("span",{className:"badge badge-success",children:"Premium"}):e.jsx("span",{className:"badge badge-success",children:"Free"})})]}),s.locked?e.jsx("button",{type:"button",onClick:()=>v("/student/premium"),className:"btn-primary text-xs",disabled:j,children:"Unlock"}):e.jsx("button",{type:"button",onClick:()=>Y(s),className:"btn-primary text-xs",disabled:j,children:"View"})]},s.id))})]}):e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Available Years"}),e.jsx("div",{className:"mt-3 grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:y.map(s=>e.jsx("button",{type:"button",onClick:()=>x(String(s.year)),className:"card text-left hover:bg-slate-50",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-base font-semibold",children:s.year}),e.jsx("div",{className:"text-xs text-slate-600",children:"Tap to view papers"})]})},s.id))}),!N&&y.length===0?e.jsx("div",{className:"mt-3 text-sm text-slate-600",children:"No years available for this centre."}):null]}):e.jsx("div",{className:"text-sm text-slate-600",children:"Select an exam centre to view PYQs."})})]})]})})}export{O as default};
