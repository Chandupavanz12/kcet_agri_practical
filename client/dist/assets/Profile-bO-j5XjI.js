import{u as C,r as l,a as i,j as e}from"./index-pB9rXeLh.js";function T(){const{token:d,user:c}=C(),[a,g]=l.useState(null),[j,o]=l.useState(!1),[N,v]=l.useState(""),[f,t]=l.useState(""),[m,u]=l.useState(""),[r,h]=l.useState(""),[w,x]=l.useState(""),[b,p]=l.useState(!1);l.useEffect(()=>{let s=!0;return(async()=>{try{const n=await i("/api/student/profile",{token:d});if(!s)return;g(n.user),v(n.user.name)}catch(n){if(!s)return;t((n==null?void 0:n.message)||"Failed to load profile")}})(),()=>{s=!1}},[d]);const y=async()=>{try{await i("/api/student/profile",{token:d,method:"PUT",body:{name:N}}),o(!1),t("Profile updated")}catch(s){t((s==null?void 0:s.message)||"Failed to update profile")}},P=async()=>{try{const s=await i("/api/student/password-reset/request",{token:d,method:"POST"});t(s.message||"OTP sent"),p(!0)}catch(s){t((s==null?void 0:s.message)||"Failed to send OTP")}},S=async()=>{if(!m.trim()){t("Enter OTP");return}if(!r){t("Enter new password");return}if(r!==w){t("Passwords do not match");return}try{const s=await i("/api/student/password-reset/reset",{token:d,method:"POST",body:{otp:m,newPassword:r}});s!=null&&s.reset?(t("Password updated"),u(""),h(""),x(""),p(!1)):t((s==null?void 0:s.message)||"Failed to reset password")}catch(s){t((s==null?void 0:s.message)||"Failed to reset password")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Profile"})}),e.jsxs("div",{className:"card-body space-y-4",children:[f&&e.jsx("div",{className:"rounded-xl border border-slate-200 bg-primary-50 p-3 text-sm text-slate-700",children:f}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Name"}),j?e.jsx("input",{className:"input",value:N,onChange:s=>v(s.target.value)}):e.jsx("div",{className:"mt-1 text-sm",children:a==null?void 0:a.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Email"}),e.jsx("div",{className:"mt-1 text-sm",children:a==null?void 0:a.email})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Role"}),e.jsx("div",{className:"mt-1 text-sm capitalize",children:a==null?void 0:a.role})]}),e.jsx("div",{className:"flex gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:y,className:"btn-primary",children:"Save"}),e.jsx("button",{onClick:()=>o(!1),className:"btn-ghost",children:"Cancel"})]}):e.jsx("button",{onClick:()=>o(!0),className:"btn-primary",children:"Edit"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Password Reset"})}),e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Request an OTP to your registered email, then verify the OTP to set a new password."}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-3 text-sm text-slate-700",children:["Registered email: ",e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.email)||(c==null?void 0:c.email)||"-"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:P,className:"btn-primary",children:"Send OTP"}),b?e.jsx("button",{onClick:()=>{p(!1),u(""),h(""),x("")},className:"btn-ghost",children:"Cancel"}):null]}),b?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"input",placeholder:"Enter OTP",value:m,onChange:s=>u(s.target.value)}),e.jsx("input",{className:"input",type:"password",placeholder:"New password",value:r,onChange:s=>h(s.target.value)}),e.jsx("input",{className:"input",type:"password",placeholder:"Confirm new password",value:w,onChange:s=>x(s.target.value)}),e.jsx("button",{onClick:S,className:"btn-primary",children:"Verify OTP & Reset Password"})]}):null]})]})]})}export{T as default};
