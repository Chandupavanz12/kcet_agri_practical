import{u as w,r as n,j as e,a as T}from"./index-pB9rXeLh.js";function I(){const{token:m}=w(),[d,h]=n.useState(""),[o,x]=n.useState(10),[v,A]=n.useState(30),[j,S]=n.useState(4),[g,B]=n.useState(!0),[c,u]=n.useState([]),[N,b]=n.useState(!1),[C,p]=n.useState(""),[f,y]=n.useState(""),D=()=>({questionText:"",imageUrl:"",optionA:"",optionB:"",optionC:"",optionD:"",correctOption:"A",uploading:!1,error:""});n.useEffect(()=>{const s=[];for(let a=0;a<o;a++)s.push(D());u(s)},[o]);const l=(s,a)=>{const t=[...c];t[s]={...t[s],...a},u(t)},Q=async(s,a)=>{if(!a)return;l(s,{uploading:!0,error:""});const t=new FormData;t.append("file",a);try{const i=await T("/api/admin/upload/specimen-image",{token:m,method:"POST",body:t,headers:{}});l(s,{imageUrl:i.url||"",uploading:!1})}catch(i){l(s,{uploading:!1,error:(i==null?void 0:i.message)||"Upload failed"})}},O=()=>!!(d.trim()&&c.every((s,a)=>s.questionText.trim()&&s.imageUrl.trim()&&s.optionA.trim()&&s.optionB.trim()&&s.optionC.trim()&&s.optionD.trim()&&["A","B","C","D"].includes(s.correctOption))),k=async()=>{var s,a;if(p(""),y(""),!O()){p("Please fill all required fields correctly.");return}b(!0);try{const t={title:d.trim(),isActive:g,perQuestionSeconds:Number(v),marksCorrect:Number(j),questionCount:Number(o),questions:c.map((r,U)=>({questionText:r.questionText.trim(),imageUrl:r.imageUrl.trim(),optionA:r.optionA.trim(),optionB:r.optionB.trim(),optionC:r.optionC.trim(),optionD:r.optionD.trim(),correctOption:r.correctOption,questionOrder:U+1}))},i=await T("/api/admin/tests/builder",{token:m,method:"POST",body:t});y(`Test created (ID: ${(s=i.test)==null?void 0:s.id}) with ${(a=i.test)==null?void 0:a.questionCount} questions.`),h(""),x(10),u([])}catch(t){p((t==null?void 0:t.message)||"Failed to create test")}finally{b(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Create Test"})}),e.jsxs("div",{className:"card-body space-y-4",children:[C?e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:C}):null,f?e.jsx("div",{className:"rounded-xl border border-green-200 bg-green-50 p-3 text-sm text-green-700",children:f}):null,e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Test Title"}),e.jsx("input",{className:"input",value:d,onChange:s=>h(s.target.value),placeholder:"Enter test title"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Number of Questions"}),e.jsx("select",{className:"input",value:o,onChange:s=>x(Number(s.target.value)),children:Array.from({length:50},(s,a)=>a+1).map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Time per Question (seconds)"}),e.jsx("input",{className:"input",type:"number",value:v,onChange:s=>A(Number(s.target.value)),min:"10",max:"300"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Marks per Correct Answer"}),e.jsx("input",{className:"input",type:"number",value:j,onChange:s=>S(Number(s.target.value)),min:"1",max:"10"})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:s=>B(s.target.checked)}),e.jsx("span",{className:"text-sm",children:"Make test active immediately"})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-base font-semibold",children:"Questions"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"space-y-6",children:c.map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h4",{className:"font-semibold",children:["Question ",a+1]})}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Question Text"}),e.jsx("input",{className:"input",value:s.questionText,onChange:t=>l(a,{questionText:t.target.value}),placeholder:"e.g., Identify the specimen below"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Upload Image"}),e.jsx("input",{className:"input",type:"file",accept:"image/*",onChange:t=>{var i;return Q(a,(i=t.target.files)==null?void 0:i[0])}}),s.uploading?e.jsx("div",{className:"mt-1 text-xs text-slate-500",children:"Uploadingâ€¦"}):null,s.error?e.jsx("div",{className:"mt-1 text-xs text-red-600",children:s.error}):null,s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:"",className:"mt-2 h-40 w-auto rounded border object-contain"}):null]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Option A"}),e.jsx("input",{className:"input",value:s.optionA,onChange:t=>l(a,{optionA:t.target.value}),placeholder:"Option A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Option B"}),e.jsx("input",{className:"input",value:s.optionB,onChange:t=>l(a,{optionB:t.target.value}),placeholder:"Option B"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Option C"}),e.jsx("input",{className:"input",value:s.optionC,onChange:t=>l(a,{optionC:t.target.value}),placeholder:"Option C"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Option D"}),e.jsx("input",{className:"input",value:s.optionD,onChange:t=>l(a,{optionD:t.target.value}),placeholder:"Option D"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Correct Option"}),e.jsxs("select",{className:"input",value:s.correctOption,onChange:t=>l(a,{correctOption:t.target.value}),children:[e.jsx("option",{value:"A",children:"Option A"}),e.jsx("option",{value:"B",children:"Option B"}),e.jsx("option",{value:"C",children:"Option C"}),e.jsx("option",{value:"D",children:"Option D"})]})]})]},a))}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{className:"btn-primary w-full",onClick:k,disabled:!O||N,children:N?"Creating Test...":"Create Test"})})]})]})]})}export{I as default};
