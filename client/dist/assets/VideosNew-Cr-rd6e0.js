import{u as V,r as n,a as h,j as e}from"./index-pB9rXeLh.js";function g(l){const i=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/watch\?.*v=([^&\n?#]+)/];for(const d of i){const u=l.match(d);if(u)return u[1]}return null}function E(l){const i=g(l);if(i){const d=`https://i.ytimg.com/vi/${i}/hqdefault.jpg`;return console.log("[VideosNew] Generated thumbnail URL:",d),d}return null}function A(){const{token:l}=V(),[i,d]=n.useState([]),[u,b]=n.useState(!0),[p,x]=n.useState(""),[o,N]=n.useState(null),[t,c]=n.useState({title:"",videoUrl:"",subject:"General",status:"active"});n.useEffect(()=>{v()},[]);const v=async()=>{try{b(!0);const s=await h("/api/admin/videos",{token:l});d(s.videos||[])}catch(s){x((s==null?void 0:s.message)||"Failed to fetch videos")}finally{b(!1)}},f=()=>{c({title:"",videoUrl:"",subject:"General",status:"active"}),N(null)},y=async s=>{s.preventDefault();try{o?await h(`/api/admin/videos/${o}`,{token:l,method:"PUT",body:t}):await h("/api/admin/videos",{token:l,method:"POST",body:t}),f(),v()}catch(a){x((a==null?void 0:a.message)||"Failed to save video")}},w=s=>{c({title:s.title,videoUrl:s.videoUrl,subject:s.subject,status:s.status}),N(s.id)},U=async s=>{if(confirm("Are you sure you want to delete this video?"))try{await h(`/api/admin/videos/${s}`,{token:l,method:"DELETE"}),v()}catch(a){x((a==null?void 0:a.message)||"Failed to delete video")}};return u?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card animate-pulse",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-6 w-32 bg-slate-200 rounded"})})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"card animate-pulse",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded"}),e.jsx("div",{className:"mt-2 h-3 w-32 bg-slate-200 rounded"})]})},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold",children:o?"Edit Video":"Add New Video"})}),e.jsxs("div",{className:"card-body",children:[p?e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:p}):null,e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Video Title"}),e.jsx("input",{className:"input",value:t.title,onChange:s=>c({...t,title:s.target.value}),placeholder:"Enter video title",required:!0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Video URL"}),e.jsx("input",{className:"input",value:t.videoUrl,onChange:s=>c({...t,videoUrl:s.target.value}),placeholder:"https://www.youtube.com/watch?v=...",required:!0}),t.videoUrl&&g(t.videoUrl)&&e.jsx("div",{className:"mt-2 text-xs text-green-600",children:"âœ“ YouTube video detected - thumbnail will be generated automatically"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Subject"}),e.jsxs("select",{className:"input",value:t.subject,onChange:s=>c({...t,subject:s.target.value}),children:[e.jsx("option",{value:"General",children:"General"}),e.jsx("option",{value:"Agriculture",children:"Agriculture"}),e.jsx("option",{value:"Biology",children:"Biology"}),e.jsx("option",{value:"Chemistry",children:"Chemistry"}),e.jsx("option",{value:"Physics",children:"Physics"}),e.jsx("option",{value:"Mathematics",children:"Mathematics"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:t.status,onChange:s=>c({...t,status:s.target.value}),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary",children:o?"Update Video":"Add Video"}),o&&e.jsx("button",{type:"button",onClick:f,className:"btn-ghost",children:"Cancel"})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"text-lg font-semibold",children:["Videos (",i.length,")"]})}),e.jsx("div",{className:"card-body",children:i.length===0?e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx("div",{className:"text-lg",children:"No videos found"}),e.jsx("div",{className:"text-sm",children:"Add your first video using the form above"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map(s=>{const a=E(s.videoUrl);return console.log("[VideosNew] Processing video:",s.title),console.log("[VideosNew] Video URL:",s.videoUrl),console.log("[VideosNew] Generated thumbnail URL:",a),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[a?e.jsx("img",{src:a,alt:s.title,className:"w-full h-40 object-cover",onError:r=>{const m=g(s.videoUrl);if(m){const j=r.target.src.split("/").pop();j==="hqdefault.jpg"?r.target.src=`https://i.ytimg.com/vi/${m}/sddefault.jpg`:j==="sddefault.jpg"?r.target.src=`https://i.ytimg.com/vi/${m}/mqdefault.jpg`:j==="mqdefault.jpg"?r.target.src=`https://i.ytimg.com/vi/${m}/default.jpg`:r.target.style.display="none"}else r.target.style.display="none"}}):e.jsx("div",{className:"w-full h-40 bg-slate-200 flex items-center justify-center",children:e.jsx("div",{className:"text-slate-500 text-sm",children:"No thumbnail available"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-sm mb-1",children:s.title}),e.jsx("div",{className:"text-xs text-slate-600 mb-2",children:s.subject}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.status}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>w(s),className:"text-xs text-blue-600 hover:text-blue-800",children:"Edit"}),e.jsx("button",{onClick:()=>U(s.id),className:"text-xs text-red-600 hover:text-red-800",children:"Delete"})]})]})]})]},s.id)})})})]})]})}export{A as default};
