import{u as I,r as n,j as e,a as x}from"./index-pB9rXeLh.js";function C(i){return(Number(i||0)/100).toLocaleString("en-IN",{style:"currency",currency:"INR"})}function D(){return new Promise(i=>{if(document.querySelector('script[data-razorpay="true"]')){i(!0);return}const l=document.createElement("script");l.src="https://checkout.razorpay.com/v1/checkout.js",l.async=!0,l.dataset.razorpay="true",l.onload=()=>i(!0),l.onerror=()=>i(!1),document.body.appendChild(l)})}function M(){var g,w,P;const{token:i,user:c}=I(),[l,k]=n.useState([]),[t,S]=n.useState(null),[A,v]=n.useState(!0),[b,f]=n.useState(!1),[j,m]=n.useState(""),[N,u]=n.useState(""),z=n.useMemo(()=>[{title:"Premium PYQs",text:"All centres + all years access (view-only)."},{title:"Premium Study Materials",text:"Unlock all paid documents (view-only)."},{title:"1 Year Validity",text:"Access remains active for 365 days from purchase."},{title:"Auto-unlock new content",text:"New premium materials become available automatically while your plan is active."}],[]),y=async()=>{const[a,r]=await Promise.all([x("/api/student/premium/plans",{token:i}),x("/api/student/premium/status",{token:i})]);k(Array.isArray(a==null?void 0:a.plans)?a.plans:[]),S((r==null?void 0:r.access)||null)};n.useEffect(()=>{let a=!0;return(async()=>{try{if(v(!0),m(""),await y(),!a)return}catch(r){if(!a)return;m((r==null?void 0:r.message)||"Failed to load premium plans")}finally{a&&v(!1)}})(),()=>{a=!1}},[i]);const _=async a=>{var r,d,o;try{f(!0),u(""),m("");const s=await x("/api/student/premium/order",{token:i,method:"POST",body:{planCode:a}});if(s!=null&&s.free){u("Premium activated successfully."),await y();return}if(!await D())throw new Error("Failed to load payment gateway");const E={key:s.keyId,amount:s.amountPaise,currency:s.currency||"INR",name:"KCET Agri",description:((r=s==null?void 0:s.plan)==null?void 0:r.name)||"Premium Access",order_id:s.orderId,prefill:{name:((d=s==null?void 0:s.user)==null?void 0:d.name)||(c==null?void 0:c.name)||"",email:((o=s==null?void 0:s.user)==null?void 0:o.email)||(c==null?void 0:c.email)||""},theme:{color:"#2563eb"},handler:async h=>{const F={razorpay_order_id:h.razorpay_order_id,razorpay_payment_id:h.razorpay_payment_id,razorpay_signature:h.razorpay_signature};await x("/api/student/premium/verify",{token:i,method:"POST",body:F}),u("Payment successful. Premium activated."),await y()},modal:{ondismiss:()=>{u("")}}};new window.Razorpay(E).open()}catch(s){m((s==null?void 0:s.message)||"Payment failed")}finally{f(!1)}};return A?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"card animate-pulse",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-slate-200"}),e.jsx("div",{className:"mt-2 h-4 w-72 rounded bg-slate-200"})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card overflow-hidden",children:e.jsx("div",{className:"card-body bg-gradient-to-r from-primary-50 via-white to-secondary-50",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-xl font-semibold",children:"Premium Access"}),e.jsx("div",{className:"mt-1 text-sm text-slate-700",children:"Unlock PYQs and premium study materials with secure payments."})]}),(g=t==null?void 0:t.combo)!=null&&g.unlocked||(w=t==null?void 0:t.pyq)!=null&&w.unlocked||(P=t==null?void 0:t.materials)!=null&&P.unlocked?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge",children:"Not active"})]})})}),j?e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:j})})}):null,N?e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 p-3 text-sm text-emerald-800",children:N})})}):null,e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:z.map(a=>e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:a.title}),e.jsx("div",{className:"mt-1 text-xs text-slate-600",children:a.text})]})},a.title))}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:l.map(a=>{var s,p;const r=String(a.code||"").toLowerCase(),d=!!((s=t==null?void 0:t[r])!=null&&s.unlocked),o=(p=t==null?void 0:t[r])==null?void 0:p.expiry;return e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-primary-600 to-secondary-600"}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:a.name}),e.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:["Validity: ",a.durationDays," days"]}),o?e.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:["Expires: ",new Date(o).toLocaleDateString()]}):null]}),d?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge",children:"Plan"})]}),e.jsx("div",{className:"mt-4 text-2xl font-bold text-slate-900",children:a.isFree?"Free":C(a.pricePaise)}),e.jsx("div",{className:"mt-4",children:d?e.jsx("button",{type:"button",disabled:!0,className:"btn-ghost text-xs",children:"Already active"}):e.jsx("button",{type:"button",disabled:b,className:"btn-primary text-xs",onClick:()=>_(r),children:b?"Please wait...":a.isFree?"Activate":"Buy now"})}),e.jsx("div",{className:"mt-3 text-[11px] text-slate-500",children:"View-only access. Download may be restricted."})]})]},a.id)})})]})}export{M as default};
