import{u as N,r as a,a as n,j as e}from"./index-pB9rXeLh.js";function f(){const{token:l}=N(),[o,x]=a.useState([]),[m,d]=a.useState(!1),[h,p]=a.useState([]),[t,j]=a.useState("");a.useEffect(()=>{(async()=>{try{const s=await n("/api/admin/tests",{token:l});p(s.tests||[])}catch(s){console.error(s)}})()},[l]),a.useEffect(()=>{(async()=>{d(!0);try{const s=t?`/api/admin/results?testId=${encodeURIComponent(t)}`:"/api/admin/results",c=await n(s,{token:l});x(c.results||[])}catch(s){console.error(s)}finally{d(!1)}})()},[l,t]);const u=async()=>{try{const s=t?`/api/admin/results/export.csv?testId=${encodeURIComponent(t)}`:"/api/admin/results/export.csv",c=await n(s,{token:l}),y=new Blob([c],{type:"text/csv"}),i=URL.createObjectURL(y),r=document.createElement("a");r.href=i,r.download="results.csv",r.click(),URL.revokeObjectURL(i)}catch{alert("Failed to export")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card overflow-hidden",children:e.jsx("div",{className:"card-body bg-gradient-to-r from-primary-50 via-white to-secondary-50",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-xl font-semibold",children:"Results"}),e.jsx("div",{className:"mt-1 text-sm text-slate-700",children:"View rankings and export results."})]}),e.jsx("button",{onClick:u,className:"btn-primary text-xs",children:"Export CSV"})]})})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-4 grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Test (for ranks)"}),e.jsxs("select",{className:"input",value:t,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"",children:"All tests (latest results)"}),h.map(s=>e.jsx("option",{value:String(s.id),children:s.title},s.id))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("div",{className:"text-sm text-slate-600",children:t?"Showing ranks by score (tie-break: less time)":"Select a test to view ranks"})})]}),m?e.jsx("div",{className:"text-sm text-slate-600",children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto rounded-2xl border border-slate-200/70 bg-white",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-slate-50/70 text-slate-700",children:[t?e.jsx("th",{className:"text-left py-2",children:"Rank"}):null,e.jsx("th",{className:"text-left py-2",children:"Date"}),e.jsx("th",{className:"text-left py-2",children:"Student"}),e.jsx("th",{className:"text-left py-2",children:"Email"}),e.jsx("th",{className:"text-left py-2",children:"Test"}),e.jsx("th",{className:"text-left py-2",children:"Score"}),e.jsx("th",{className:"text-left py-2",children:"Accuracy"}),e.jsx("th",{className:"text-left py-2",children:"Time (s)"})]})}),e.jsx("tbody",{children:o.map(s=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[t?e.jsx("td",{className:"py-3 font-semibold",children:s.rank??""}):null,e.jsx("td",{className:"py-3",children:new Date(s.date).toLocaleDateString()}),e.jsx("td",{className:"py-2",children:s.student_name}),e.jsx("td",{className:"py-2",children:s.student_email}),e.jsx("td",{className:"py-2",children:s.test_title}),e.jsx("td",{className:"py-2",children:s.score}),e.jsxs("td",{className:"py-2",children:[s.accuracy,"%"]}),e.jsx("td",{className:"py-2",children:s.time_taken_sec})]},s.id))})]})})]})})]})}export{f as default};
