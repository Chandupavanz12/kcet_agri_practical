import{u as S,c as $,d as R,r as x,a as j,j as e}from"./index-pB9rXeLh.js";function I(){const{token:n}=S(),l=$(),[N]=R(),o=N.get("testId"),[m,f]=x.useState(null),[v,h]=x.useState(!0);if(x.useEffect(()=>{let s=!0;return(async()=>{var a;try{h(!0);const t=await j(`/api/student/results?testId=${o}`,{token:n});if(!s)return;const r=(a=t.results)==null?void 0:a[0];if(!r)throw new Error("Result not found");const d=await j(`/api/student/results/${r.id}`,{token:n});if(!s)return;f(d.result)}catch(t){if(!s)return;alert((t==null?void 0:t.message)||"Failed to load result"),l("/student/dashboard",{replace:!0})}finally{if(!s)return;h(!1)}})(),()=>{s=!1}},[n,o,l]),v)return e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading result..."})});if(!m)return e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Result not found"})});const{score:g,outOf:b,accuracy:p,correctCount:y,wrongCount:w,totalQuestions:T,timeTakenSec:u,rank:C,date:A,responses:k}=m;return e.jsx("div",{className:"min-h-screen bg-slate-50",children:e.jsx("main",{className:"mx-auto max-w-4xl px-4 py-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Test Result"}),e.jsx("p",{className:"mt-1 text-sm text-slate-600",children:m.testTitle})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"Score"}),e.jsxs("div",{className:"mt-2 text-4xl font-bold text-primary-600",children:[g," / ",b]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"Rank"}),e.jsxs("div",{className:"mt-2 text-4xl font-bold text-slate-700",children:["#",C]})]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"Accuracy"}),e.jsxs("div",{className:"mt-2 text-2xl font-semibold",children:[p,"%"]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"Correct"}),e.jsx("div",{className:"mt-2 text-2xl font-semibold text-green-600",children:y})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"Wrong"}),e.jsx("div",{className:"mt-2 text-2xl font-semibold text-red-600",children:w})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"Time"}),e.jsxs("div",{className:"mt-2 text-2xl font-semibold",children:[Math.floor(u/60),":",(u%60).toString().padStart(2,"0")]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Answer Review"})}),e.jsx("div",{className:"card-body space-y-6",children:k.sort((s,a)=>s.questionOrder-a.questionOrder).map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-sm font-semibold",children:a+1}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.questionText}),e.jsx("div",{className:`text-sm ${s.correct?"text-green-600":"text-red-600"}`,children:s.correct?"✓ Correct":"✗ Wrong"})]})]})}),s.imageUrl&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.imageUrl.startsWith("http")?s.imageUrl:`http://localhost:5001${s.imageUrl}`,alt:`Question ${a+1}`,className:"h-48 w-auto rounded-lg border object-contain",onError:t=>{t.target.src="https://via.placeholder.com/400x300?text=Image+Not+Available",t.target.onerror=null}})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:s.options.map((t,r)=>{const d=String.fromCharCode(65+r),c=s.selectedIndex===r,i=s.correctOption===d;return e.jsx("div",{className:`p-3 rounded-lg border-2 text-sm ${c&&i?"border-green-500 bg-green-50":c&&!i?"border-red-500 bg-red-50":i?"border-green-300 bg-green-50":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${c?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:c&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),e.jsxs("span",{className:"font-medium",children:[d,"."]}),e.jsx("span",{children:t}),i&&e.jsx("span",{className:"ml-auto text-green-600 text-xs font-semibold",children:"✓ Correct"})]})},r)})}),e.jsxs("div",{className:"text-sm text-slate-600 border-t pt-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Your Answer:"})," ",s.selected!==null?`${s.selected} (${String.fromCharCode(65+s.selectedIndex)})`:"Not answered"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Correct Answer:"})," ",s.correctOption]})]})]},s.questionId))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>l("/student/dashboard"),className:"btn-primary",children:"Back to Dashboard"}),e.jsx("button",{onClick:()=>l(`/student/mock-test/${o}`),className:"btn-secondary",children:"Retake Test"})]})]})})})}export{I as default};
