import{u as h,r as o,j as a,a as u}from"./index-pB9rXeLh.js";import{A as b}from"./AdminCRUDPage-DdMK7M0-.js";function P(){const{token:c}=h(),[s,r]=o.useState(""),[t,p]=o.useState("free"),m=s&&!/^https?:\/\//i.test(s)?`http://localhost:5001${s.startsWith("/")?"":"/"}${s}`:s,f=async e=>{const l=e.target.files[0];if(!l)return;const n=new FormData;n.append("file",l);try{const d=await u(t==="paid"?"/api/admin/upload/material-private":"/api/admin/upload/material-pdf",{token:c,method:"POST",body:n,headers:{}});r(t==="paid"?d.ref:d.url)}catch(i){alert((i==null?void 0:i.message)||"Upload failed")}},y=[{name:"title",label:"Title",type:"text"},{name:"subject",label:"Subject",type:"text"},{name:"type",label:"Type",type:"select",options:[{value:"pdf",label:"PDF"},{value:"pyq",label:"PYQ"}]},{name:"accessType",label:"Access",type:"select",options:[{value:"free",label:"Free (Public)"},{value:"paid",label:"Paid (Premium / Private)"}]}];return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"card-header",children:a.jsx("h2",{className:"text-lg font-semibold",children:"Upload PDF"})}),a.jsxs("div",{className:"card-body space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"label",children:"Upload as"}),a.jsxs("select",{value:t,onChange:e=>{p(e.target.value),r("")},className:"input",children:[a.jsx("option",{value:"free",children:"Free (Public)"}),a.jsx("option",{value:"paid",children:"Paid (Private)"})]})]}),a.jsx("input",{type:"file",accept:".pdf,.png,.jpg,.jpeg,.webp,.gif,.doc,.docx,.ppt,.pptx",onChange:f,className:"input"}),s&&a.jsxs("div",{children:[a.jsx("div",{className:"label",children:"File Reference (copied to form)"}),a.jsx("input",{type:"text",value:s,readOnly:!0,className:"input",onClick:e=>e.target.select()}),t==="free"?a.jsx("a",{href:m,target:"_blank",rel:"noopener noreferrer",className:"btn-primary text-xs mt-2 inline-block",children:"Preview"}):null]})]})]}),a.jsx(b,{title:"Manage Materials",apiEndpoint:"materials",fields:y,initialForm:{title:"",pdf_url:s||"",subject:"General",type:"pdf",accessType:t||"free"},onFormChange:e=>(e&&typeof e=="object"&&typeof e.accessType=="string"&&p(e.accessType),e),listTransform:e=>({...e,accessType:e.accessType||e.access_type||"free"}),customCreateHandler:async e=>{const l={title:e.title,pdf_url:s||"",subject:e.subject,type:e.type,access_type:e.accessType||t||"free"};return await u("/api/admin/materials",{token:c,method:"POST",body:l})}})]})}export{P as default};
